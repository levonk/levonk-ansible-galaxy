---
# tasks file for levonk.vibeops.tools - Espanso

- name: Install Espanso via levonk.common.package (cross-platform)
  levonk.common.package:
    name:
      - espanso
    state: latest
  register: espanso_pkg_result
  failed_when: false
  tags:
    - vibeops
    - tools
    - espanso

- name: Fallback: Install Espanso via script if package fails (Debian)
  become: true
  block:
    - name: Download Espanso installation script
      ansible.builtin.get_url:
        url: https://sh.espanso.org/install
        dest: /tmp/install_espanso.sh
        mode: '0755'
    - name: Run Espanso installation script
      ansible.builtin.command:
        cmd: /tmp/install_espanso.sh
        creates: /usr/local/bin/espanso
    - name: Clean up installation script
      ansible.builtin.file:
        path: /tmp/install_espanso.sh
        state: absent
  when: ansible_os_family == 'Debian' and espanso_pkg_result is failed
  tags:
    - vibeops
    - tools
    - espanso
    - fallback

